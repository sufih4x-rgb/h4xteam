<!DOCTYPE html>
<html>
<head>
<title>Deposit - H4XTEAM</title>
<style>
body{background:#000;color:#0affff;font-family:Arial;text-align:center;padding-top:40px}
input{width:80%;padding:12px;background:#111;border:1px solid #0affff;color:#0affff;border-radius:8px}
button{padding:15px;width:80%;margin-top:20px;background:#0affff;color:#000;border:none;border-radius:8px;font-weight:bold}
img{margin-top:20px;border:2px solid #0affff;border-radius:10px}
</style>
</head>
<body>

<h1>Deposit</h1>
<input id="amount" type="number" placeholder="Enter Deposit Amount (50-500)">
<button onclick="makeQR()">Generate QR</button>

<div id="details"></div>
<img id="qr" width="250" style="display:none">

<button onclick="window.location='dashboard.html'">Back</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig={
 apiKey:"AIzaSyAzfvbiqRqsQwBOOIkegxJD09di-S_tfHg",
 authDomain:"test-eb5e7.firebaseapp.com",
 databaseURL:"https://test-eb5e7-default-rtdb.firebaseio.com",
 projectId:"test-eb5e7",
 storageBucket:"test-eb5e7.appspot.com",
 messagingSenderId:"366282855653",
 appId:"1:366282855653:web:dca7e000f5a22fb11f300c",
 measurementId:"G-ECKCTBLQJ8"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getDatabase(app);

let uid="";

onAuthStateChanged(auth,u=>{ if(!u) window.location='index.html'; uid=u.uid; });

window.makeQR = async function(){
 let amt = Number(document.getElementById("amount").value);

 if(amt<50 || amt>500){ alert("Deposit must be between 50 to 500"); return; }

 let payAmount = amt + (amt * 0.10);

 let txid = "TX" + Math.floor(Math.random()*9999999);

 document.getElementById("details").innerHTML =
   `<p>Pay Amount: <b>â‚¹${payAmount}</b></p>
    <p>UPI ID: <b>9561998301@amazonpay</b></p>
    <p>Transaction ID: <b>${txid}</b></p>`;

 document.getElementById("qr").src = 
   "https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=upi://pay?pa=9561998301@amazonpay&am="+payAmount;
 document.getElementById("qr").style.display="block";

 await set(ref(db,"transactions/deposits/"+uid+"/"+txid),{
   amount:amt,
   pay:payAmount,
   status:"pending",
   time:Date.now()
 });
}
</script>

</body>
</html>
