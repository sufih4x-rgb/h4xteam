<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixed Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        tr:nth-child(even) { background-color: #f8fafc; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div class="flex flex-col md:flex-row">
        <div class="w-full md:w-64 bg-slate-900 text-white md:min-h-screen">
            <div class="p-6 text-center border-b border-slate-700 font-bold text-xl">ADMIN PANEL</div>
            <nav class="flex md:flex-col overflow-x-auto">
                <button onclick="showTab('withdraw-tab')" class="p-4 hover:bg-slate-800 flex-1 text-left border-b border-slate-700"><i class="fas fa-wallet mr-2"></i> Withdraws</button>
                <button onclick="showTab('deposit-tab')" class="p-4 hover:bg-slate-800 flex-1 text-left border-b border-slate-700"><i class="fas fa-university mr-2"></i> Deposits</button>
                <button onclick="showTab('recharge-tab')" class="p-4 hover:bg-slate-800 flex-1 text-left border-b border-slate-700"><i class="fas fa-mobile-alt mr-2"></i> Recharges</button>
                <button onclick="showTab('users-tab')" class="p-4 hover:bg-slate-800 flex-1 text-left border-b border-slate-700"><i class="fas fa-users mr-2"></i> User List</button>
            </nav>
        </div>

        <div class="flex-1 p-6">
            
            <div id="withdraw-tab" class="tab-content active">
                <h2 class="text-2xl font-bold mb-4">Pending Withdrawals</h2>
                <div class="bg-white rounded-lg shadow overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="p-4">UID</th>
                                <th class="p-4">Amount</th>
                                <th class="p-4">UPI ID</th>
                                <th class="p-4">Action</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawBody"><tr><td colspan="4" class="p-4 text-center text-gray-400">Loading data...</td></tr></tbody>
                    </table>
                </div>
            </div>

            <div id="deposit-tab" class="tab-content">
                <h2 class="text-2xl font-bold mb-4">Pending Deposits</h2>
                <div class="bg-white rounded-lg shadow overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="p-4">UID</th>
                                <th class="p-4">Amount</th>
                                <th class="p-4">Trx ID</th>
                                <th class="p-4">Action</th>
                            </tr>
                        </thead>
                        <tbody id="depositBody"><tr><td colspan="4" class="p-4 text-center text-gray-400">Loading data...</td></tr></tbody>
                    </table>
                </div>
            </div>

            <div id="recharge-tab" class="tab-content">
                <h2 class="text-2xl font-bold mb-4">SIM Recharges</h2>
                <div class="bg-white rounded-lg shadow overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="p-4">Number</th>
                                <th class="p-4">Amount/Plan</th>
                                <th class="p-4">UID</th>
                                <th class="p-4">Action</th>
                            </tr>
                        </thead>
                        <tbody id="rechargeBody"><tr><td colspan="4" class="p-4 text-center text-gray-400">Loading data...</td></tr></tbody>
                    </table>
                </div>
            </div>

            <div id="users-tab" class="tab-content">
                <h2 class="text-2xl font-bold mb-4">All Registered Users</h2>
                <div class="bg-white rounded-lg shadow overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="p-4">Name/UID</th>
                                <th class="p-4">Balance</th>
                                <th class="p-4">Status</th>
                                <th class="p-4">Control</th>
                            </tr>
                        </thead>
                        <tbody id="userListBody"></tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, remove, get } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

       const firebaseConfig = {
  apiKey: "AIzaSyAzfvbiqRqsQwBOOIkegxJD09di-S_tfHg",
  authDomain: "test-eb5e7.firebaseapp.com",
  databaseURL: "https://test-eb5e7-default-rtdb.firebaseio.com",
  projectId: "test-eb5e7",
  storageBucket: "test-eb5e7.appspot.com",
  messagingSenderId: "366282855653",
  appId: "1:366282855653:web:dca7e000f5a22fb11f300c",
  measurementId: "G-ECKCTBLQJ8"
};

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- Tab Switching ---
        window.showTab = (id) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        };

        // --- Data Listeners ---

        // 1. Withdraws
        onValue(ref(db, 'withdraws'), (snap) => {
            const body = document.getElementById('withdrawBody');
            body.innerHTML = "";
            if (!snap.exists()) body.innerHTML = "<tr><td colspan='4' class='p-4 text-center'>No pending withdraws</td></tr>";
            snap.forEach(child => {
                const d = child.val();
                body.innerHTML += `<tr>
                    <td class="p-4 text-xs font-mono">${d.uid}</td>
                    <td class="p-4 font-bold text-red-600">$${d.amount}</td>
                    <td class="p-4 text-blue-600">${d.upi || 'N/A'}</td>
                    <td class="p-4">
                        <button onclick="actionReq('withdraws', '${child.key}', 'Approved')" class="bg-green-500 text-white px-3 py-1 rounded text-xs mr-1">Approve</button>
                        <button onclick="actionReq('withdraws', '${child.key}', 'Rejected')" class="bg-red-500 text-white px-3 py-1 rounded text-xs">Reject</button>
                    </td>
                </tr>`;
            });
        });

        // 2. Deposits
        onValue(ref(db, 'deposits'), (snap) => {
            const body = document.getElementById('depositBody');
            body.innerHTML = "";
            if (!snap.exists()) body.innerHTML = "<tr><td colspan='4' class='p-4 text-center'>No pending deposits</td></tr>";
            snap.forEach(child => {
                const d = child.val();
                body.innerHTML += `<tr>
                    <td class="p-4 text-xs font-mono">${d.uid}</td>
                    <td class="p-4 font-bold text-green-600">$${d.amount}</td>
                    <td class="p-4 text-sm">${d.trxId || 'N/A'}</td>
                    <td class="p-4">
                        <button onclick="approveDeposit('${child.key}', '${d.uid}', ${d.amount})" class="bg-green-500 text-white px-3 py-1 rounded text-xs mr-1">Approve</button>
                        <button onclick="actionReq('deposits', '${child.key}', 'Rejected')" class="bg-red-500 text-white px-3 py-1 rounded text-xs">Reject</button>
                    </td>
                </tr>`;
            });
        });

        // 3. Recharges
        onValue(ref(db, 'recharges'), (snap) => {
            const body = document.getElementById('rechargeBody');
            body.innerHTML = "";
            if (!snap.exists()) body.innerHTML = "<tr><td colspan='4' class='p-4 text-center'>No recharge requests</td></tr>";
            snap.forEach(child => {
                const d = child.val();
                body.innerHTML += `<tr>
                    <td class="p-4 font-bold">${d.number}</td>
                    <td class="p-4">${d.amount || d.plan}</td>
                    <td class="p-4 text-xs">${d.uid}</td>
                    <td class="p-4">
                        <button onclick="actionReq('recharges', '${child.key}', 'Approved')" class="bg-blue-500 text-white px-3 py-1 rounded text-xs mr-1">Done</button>
                        <button onclick="actionReq('recharges', '${child.key}', 'Rejected')" class="bg-red-500 text-white px-3 py-1 rounded text-xs">Reject</button>
                    </td>
                </tr>`;
            });
        });

        // 4. Users (Ban/Unban)
        onValue(ref(db, 'users'), (snap) => {
            const body = document.getElementById('userListBody');
            body.innerHTML = "";
            snap.forEach(child => {
                const u = child.val();
                const isBanned = u.status === 'Banned';
                body.innerHTML += `<tr>
                    <td class="p-4 border-b">
                        <div class="font-bold">${u.name || 'User'}</div>
                        <div class="text-[10px] text-gray-400">${child.key}</div>
                    </td>
                    <td class="p-4 border-b font-bold text-green-600">$${u.balance || 0}</td>
                    <td class="p-4 border-b">
                        <span class="text-xs font-bold ${isBanned ? 'text-red-500' : 'text-green-500'}">${u.status || 'Active'}</span>
                    </td>
                    <td class="p-4 border-b">
                        <button onclick="toggleUserBan('${child.key}', '${u.status}')" class="text-xs font-bold underline ${isBanned ? 'text-blue-500' : 'text-red-500'}">
                            ${isBanned ? 'Unban' : 'Ban'}
                        </button>
                    </td>
                </tr>`;
            });
        });

        // --- Functions ---
        window.actionReq = async (path, key, status) => {
            if(confirm(`Mark as ${status}?`)) {
                await remove(ref(db, `${path}/${key}`));
                alert("Updated!");
            }
        };

        window.approveDeposit = async (key, uid, amt) => {
            const userRef = ref(db, `users/${uid}`);
            const snap = await get(userRef);
            if(snap.exists()){
                const newBal = (snap.val().balance || 0) + parseFloat(amt);
                await update(userRef, { balance: newBal });
                await remove(ref(db, `deposits/${key}`));
                alert("Deposit Approved & Balance Added!");
            }
        };

        window.toggleUserBan = async (uid, currentStatus) => {
            const newStatus = currentStatus === 'Banned' ? 'Active' : 'Banned';
            await update(ref(db, `users/${uid}`), { status: newStatus });
        };

    </script>
</body>
</html>
