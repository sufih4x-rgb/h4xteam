<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>H4XTEAM ADMIN PANEL</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        background: #000;
        color: white;
        font-family: Arial, sans-serif;
        margin: 0;
    }

    .login-box, .admin-box {
        width: 90%;
        max-width: 450px;
        margin: 80px auto;
        padding: 25px;
        background: rgba(20,20,20,0.8);
        border: 1px solid #0ff;
        box-shadow: 0 0 20px #0ff;
        border-radius: 8px;
        display: none;
    }

    .active { display: block; }

    h2 {
        text-align: center;
        color: #0ff;
        text-shadow: 0 0 10px #0ff;
    }

    input, select {
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        background: black;
        border: 1px solid #0ff;
        color: white;
        border-radius: 5px;
        box-shadow: 0 0 10px #0ff;
    }

    button {
        width: 100%;
        padding: 12px;
        margin-top: 12px;
        background: #0ff;
        color: black;
        font-weight: bold;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        box-shadow: 0 0 12px #0ff;
    }

    button:hover {
        background: #09d;
        box-shadow: 0 0 20px #09d;
    }

    .section {
        background: rgba(10,10,10,0.7);
        border: 1px solid #0ff;
        padding: 15px;
        margin: 15px 0;
        box-shadow: 0 0 10px #0ff;
    }

    .user-card {
        padding: 12px;
        border-bottom: 1px solid #0ff;
        margin-bottom: 12px;
    }

    .small-btn {
        padding: 6px 10px;
        font-size: 14px;
        margin: 5px;
        display: inline-block;
        background: #0ff;
        color: black;
        border-radius: 4px;
        cursor: pointer;
    }

</style>
</head>
<body>

<!-- LOGIN BOX -->
<div class="login-box active" id="loginBox">
    <h2>ADMIN LOGIN</h2>
    <input type="password" id="adminPass" placeholder="Enter Admin Password">
    <button onclick="loginAdmin()">LOGIN</button>
</div>

<!-- ADMIN PANEL -->
<div class="admin-box" id="adminBox">
    <h2>H4XTEAM ADMIN PANEL</h2>

    <button onclick="loadUsers()">LOAD USERS</button>
    <button onclick="loadDeposits()">PENDING DEPOSITS</button>
    <button onclick="loadWithdrawals()">PENDING WITHDRAWALS</button>
    <button onclick="loadIPLogs()">IP LOGS</button>

    <div id="content"></div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, get, update, remove, set } 
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAzfvbiqRqsQwBOOIkegxJD09di-S_tfHg",
  authDomain: "test-eb5e7.firebaseapp.com",
  databaseURL: "https://test-eb5e7-default-rtdb.firebaseio.com",
  projectId: "test-eb5e7",
  storageBucket: "test-eb5e7.appspot.com",
  messagingSenderId: "366282855653",
  appId: "1:366282855653:web:dca7e000f5a22fb11f300c",
  measurementId: "G-ECKCTBLQJ8"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// --- ADMIN LOGIN ---
function loginAdmin() {
    let pass = document.getElementById("adminPass").value;
    if (pass === "H4XTEAMADMIN") {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("adminBox").style.display = "block";
    } else {
        alert("WRONG PASSWORD!");
    }
}
window.loginAdmin = loginAdmin;

// --- LOAD USERS ---
async function loadUsers() {
    const content = document.getElementById("content");
    content.innerHTML = "<h3>Loading Users...</h3>";

    const snap = await get(ref(db, "users"));
    if (!snap.exists()) return content.innerHTML = "No users found.";

    let html = "<h3>ALL USERS</h3>";

    snap.forEach(user => {
        let u = user.val();
        let uid = user.key;

        html += `
        <div class="user-card">
            <b>${u.email}</b><br>
            UID: ${uid}<br>
            Balance: ₹${u.balance}<br>
            Deposits: ${u.deposits}<br>
            VIP: ${u.vip}<br>
            Lifetime Wins: ₹${u.lifetimeWins}<br>
            Blocked: ${u.blocked}<br>
            <button class="small-btn" onclick="editUser('${uid}')">EDIT</button>
            <button class="small-btn" onclick="deleteUser('${uid}')">DELETE</button>
        </div>`;
    });

    content.innerHTML = html;
}
window.loadUsers = loadUsers;

// --- EDIT USER ---
async function editUser(uid) {
    const userSnap = await get(ref(db, "users/" + uid));
    if (!userSnap.exists()) return alert("User not found!");

    let u = userSnap.val();

    let newBalance = prompt("Enter new balance:", u.balance);
    let newDeposits = prompt("Enter deposit count:", u.deposits);
    let newWins = prompt("Enter lifetime wins:", u.lifetimeWins);
    let newVIP = prompt("Enter VIP level (0-3):", u.vip);
    let block = confirm("Block user? (OK = Yes, Cancel = No)");

    update(ref(db, "users/" + uid), {
        balance: Number(newBalance),
        deposits: Number(newDeposits),
        lifetimeWins: Number(newWins),
        vip: Number(newVIP),
        blocked: block
    });

    alert("Updated!");
    loadUsers();
}
window.editUser = editUser;

// DELETE USER
function deleteUser(uid) {
    if (!confirm("Delete this user?")) return;

    remove(ref(db, "users/" + uid));
    alert("Deleted!");
    loadUsers();
}
window.deleteUser = deleteUser;

// --- LOAD PENDING DEPOSITS ---
async function loadDeposits() {
    const content = document.getElementById("content");
    content.innerHTML = "<h3>Loading deposits...</h3>";

    const snap = await get(ref(db, "pendingDeposits"));
    if (!snap.exists()) return content.innerHTML = "No deposits.";

    let html = "<h3>PENDING DEPOSITS</h3>";

    snap.forEach(d => {
        let x = d.val();
        let id = d.key;

        html += `
        <div class="user-card">
            UID: ${x.uid}<br>
            Amount: ₹${x.amount}<br>
            <button class="small-btn" onclick="approveDeposit('${id}','${x.uid}',${x.amount})">APPROVE</button>
            <button class="small-btn" onclick="rejectDeposit('${id}')">REJECT</button>
        </div>`;
    });

    content.innerHTML = html;
}
window.loadDeposits = loadDeposits;

// APPROVE DEPOSIT
async function approveDeposit(id, uid, amount) {
    const userSnap = await get(ref(db, "users/" + uid));
    if (!userSnap.exists()) return alert("User missing!");

    let balance = userSnap.val().balance;
    let deposits = userSnap.val().deposits;

    update(ref(db, "users/" + uid), {
        balance: balance + amount,
        deposits: deposits + 1
    });

    remove(ref(db, "pendingDeposits/" + id));
    alert("Deposit approved!");
    loadDeposits();
}
window.approveDeposit = approveDeposit;

// REJECT DEPOSIT
function rejectDeposit(id) {
    remove(ref(db, "pendingDeposits/" + id));
    alert("Rejected!");
    loadDeposits();
}
window.rejectDeposit = rejectDeposit;

// --- LOAD WITHDRAWALS ---
async function loadWithdrawals() {
    const content = document.getElementById("content");
    content.innerHTML = "Loading withdrawals...";

    const snap = await get(ref(db, "pendingWithdrawals"));
    if (!snap.exists()) return content.innerHTML = "No withdrawals.";

    let html = "<h3>PENDING WITHDRAWALS</h3>";

    snap.forEach(w => {
        let x = w.val();
        let id = w.key;

        html += `
        <div class="user-card">
            UID: ${x.uid}<br>
            Amount: ₹${x.amount}<br>
            UPI: ${x.upi}<br>
            <button class="small-btn" onclick="approveWithdraw('${id}')">APPROVE</button>
            <button class="small-btn" onclick="rejectWithdraw('${id}')">REJECT</button>
        </div>`;
    });

    content.innerHTML = html;
}
window.loadWithdrawals = loadWithdrawals;

// APPROVE WITHDRAW
function approveWithdraw(id) {
    remove(ref(db, "pendingWithdrawals/" + id));
    alert("Withdraw Approved!");
    loadWithdrawals();
}
window.approveWithdraw = approveWithdraw;

function rejectWithdraw(id) {
    remove(ref(db, "pendingWithdrawals/" + id));
    alert("Withdraw Rejected!");
    loadWithdrawals();
}
window.rejectWithdraw = rejectWithdraw;

// --- IP LOGS ---
async function loadIPLogs() {
    const content = document.getElementById("content");

    const snap = await get(ref(db, "ipLogs"));
    if (!snap.exists()) return content.innerHTML = "No IP logs.";

    let html = "<h3>IP LOGS</h3>";

    snap.forEach(i => {
        let x = i.val();
        html += `
        <div class="user-card">
            UID: ${i.key}<br>
            IP: ${x.ip}<br>
            Last Login: ${x.timestamp}
        </div>`;
    });

    content.innerHTML = html;
}
window.loadIPLogs = loadIPLogs;

</script>
</body>
</html>
