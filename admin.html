<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>H4XTEAM ADMIN PANEL</title>
    <style>
        body { background:#000; color:#0aff9d; font-family: 'Courier New', monospace; padding:20px; }
        h1 { text-align:center; color:#00ffdd; text-shadow:0 0 15px #00ffff; }
        .section { margin-top:30px; padding:20px; border:2px solid #00ffaa; border-radius:10px; background: rgba(0,255,170,0.05); }
        table { width:100%; margin-top:15px; border-collapse:collapse; background: #111; }
        th, td { border:1px solid #333; padding:12px; text-align:center; }
        th { background: #00ffaa; color: #000; }
        input { background:#111; color:#0aff9d; border:1px solid #00ffaa; padding:8px; border-radius:5px; width: 80px; }
        button { padding:8px 15px; border-radius:5px; font-weight:bold; cursor:pointer; border: none; transition: 0.3s; }
        .green { background:#00ff99; color: #000; }
        .green:hover { background: #00cc77; }
        .red { background:#ff4444; color:#fff; }
        .red:hover { background: #cc3333; }
        #loginOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <h1>ADMIN ACCESS REQUIRED</h1>
    <input type="password" id="adminPass" placeholder="Enter Password" style="width:200px; margin-bottom:10px;">
    <button class="green" onclick="checkAuth()">UNLOCK PANEL</button>
</div>

<h1>⚡ H4XTEAM ADMIN SYSTEM ⚡</h1>

<div class="section">
    <h2>User Management</h2>
    <table id="userTable">
        <tr><th>UID</th><th>Balance</th><th>Total Won</th><th>Action</th></tr>
    </table>
</div>

<div class="section">
    <h2>Pending Deposits</h2>
    <table id="depositTable">
        <tr><th>UID</th><th>Amount</th><th>TXID</th><th>Action</th></tr>
    </table>
</div>

<div class="section">
    <h2>Pending Withdrawals</h2>
    <table id="withdrawTable">
        <tr><th>UID</th><th>Amount</th><th>WID</th><th>Action</th></tr>
    </table>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
  apiKey: "AIzaSyAzfvbiqRqsQwBOOIkegxJD09di-S_tfHg",
  authDomain: "test-eb5e7.firebaseapp.com",
  databaseURL: "https://test-eb5e7-default-rtdb.firebaseio.com",
  projectId: "test-eb5e7",
  storageBucket: "test-eb5e7.appspot.com",
  messagingSenderId: "366282855653",
  appId: "1:366282855653:web:dca7e000f5a22fb11f300c",
  measurementId: "G-ECKCTBLQJ8"
};

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- AUTH CHECK ---
    window.checkAuth = function() {
        const pass = document.getElementById("adminPass").value;
        if(pass === "admin123") { // CHANGE THIS PASSWORD
            document.getElementById("loginOverlay").style.display = "none";
            loadAllData();
        } else {
            alert("Access Denied");
        }
    };

    function loadAllData() {
        // Load Users
        onValue(ref(db, "users/"), snap => {
            let table = document.getElementById("userTable");
            table.innerHTML = `<tr><th>UID</th><th>Balance</th><th>Total Won</th><th>Manual Adjust</th></tr>`;
            snap.forEach(user => {
                let d = user.val();
                table.innerHTML += `
                <tr>
                    <td>${user.key}</td>
                    <td>₹${d.balance || 0}</td>
                    <td>${d.totalWon || 0}</td>
                    <td>
                        <input id="amt_${user.key}" type="number" placeholder="Amt">
                        <button class="green" onclick="adjustBalance('${user.key}', 'add')">+</button>
                        <button class="red" onclick="adjustBalance('${user.key}', 'sub')">-</button>
                    </td>
                </tr>`;
            });
        });

        // Load Deposits
        onValue(ref(db, "transactions/deposits/"), snap => {
            let table = document.getElementById("depositTable");
            table.innerHTML = `<tr><th>UID</th><th>Amount</th><th>TXID</th><th>Action</th></tr>`;
            snap.forEach(userNode => {
                userNode.forEach(tx => {
                    let d = tx.val();
                    if(d.status === "pending") {
                        table.innerHTML += `
                        <tr>
                            <td>${userNode.key}</td>
                            <td>₹${d.amount}</td>
                            <td>${tx.key}</td>
                            <td>
                                <button class="green" onclick="handleDeposit('${userNode.key}','${tx.key}',${d.amount},'approved')">Approve</button>
                                <button class="red" onclick="handleDeposit('${userNode.key}','${tx.key}',0,'rejected')">Reject</button>
                            </td>
                        </tr>`;
                    }
                });
            });
        });

        // Load Withdrawals
        onValue(ref(db, "transactions/withdrawals/"), snap => {
            let table = document.getElementById("withdrawTable");
            table.innerHTML = `<tr><th>UID</th><th>Amount</th><th>WID</th><th>Action</th></tr>`;
            snap.forEach(userNode => {
                userNode.forEach(wd => {
                    let d = wd.val();
                    if(d.status === "pending") {
                        table.innerHTML += `
                        <tr>
                            <td>${userNode.key}</td>
                            <td>₹${d.amount}</td>
                            <td>${wd.key}</td>
                            <td>
                                <button class="green" onclick="handleWithdraw('${userNode.key}','${wd.key}',${d.amount},'approved')">Confirm Pay</button>
                                <button class="red" onclick="handleWithdraw('${userNode.key}','${wd.key}',${d.amount},'rejected')">Reject (Refund)</button>
                            </td>
                        </tr>`;
                    }
                });
            });
        });
    }

    // --- LOGIC FUNCTIONS ---

    window.adjustBalance = function(uid, type) {
        let val = Number(document.getElementById("amt_"+uid).value);
        if(!val) return alert("Enter amount");
        let finalAmt = type === 'add' ? val : -val;
        update(ref(db, `users/${uid}`), { balance: increment(finalAmt) });
        alert("Success");
    };

    window.handleDeposit = function(uid, txid, amount, status) {
        if(status === 'approved') {
            update(ref(db, `users/${uid}`), { balance: increment(amount) });
        }
        update(ref(db, `transactions/deposits/${uid}/${txid}`), { status: status });
    };

    window.handleWithdraw = function(uid, wid, amount, status) {
        if(status === 'rejected') {
            // Refund the balance if rejected
            update(ref(db, `users/${uid}`), { balance: increment(amount) });
        }
        // If approved, we don't subtract again because it's usually subtracted when user requests it
        update(ref(db, `transactions/withdrawals/${uid}/${wid}`), { status: status });
    };

</script>
</body>
</html>
