<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Admin v3.0 | H4XTEAM</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #4361ee; --success: #06d6a0; --danger: #ff4d4d; --bg: #f8faff; --white: #fff; --text: #1e293b; }
        body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); display: flex; }
        
        /* Sidebar */
        .sidebar { width: 260px; height: 100vh; background: var(--white); border-right: 1px solid #e2e8f0; position: fixed; padding-top: 20px; }
        .nav-item { padding: 15px 25px; cursor: pointer; font-weight: 700; color: #64748b; border-right: 4px solid transparent; transition: 0.3s; }
        .nav-item.active { background: #eef2ff; color: var(--primary); border-color: var(--primary); }
        
        /* Main */
        .main { margin-left: 260px; width: 100%; padding: 40px; }
        .section { background: var(--white); padding: 25px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); margin-bottom: 25px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; padding: 12px; background: #f1f5f9; font-size: 12px; color: #64748b; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 13px; font-weight: 600; }
        
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .badge-pending { background: #fef3c7; color: #d97706; }
        .badge-success { background: #d1fae5; color: #059669; }
        
        button { padding: 8px 12px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; font-size: 11px; }
        .btn-green { background: var(--success); color: white; }
        .btn-red { background: var(--danger); color: white; }
        .btn-blue { background: var(--primary); color: white; }

        #loginOverlay { position: fixed; inset: 0; background: var(--primary); display: flex; align-items: center; justify-content: center; z-index: 10000; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div style="background:white; padding:40px; border-radius:30px; text-align:center;">
        <h2>Admin Access</h2>
        <input type="password" id="adminPass" placeholder="Password" style="padding:12px; border-radius:10px; border:1px solid #ddd; width:200px;"><br><br>
        <button class="btn-blue" style="width:100%; padding:15px;" onclick="checkAuth()">Login</button>
    </div>
</div>

<div class="sidebar">
    <div style="padding: 25px; font-size: 20px; font-weight: 800; color: var(--primary);">H4X ADMIN</div>
    <div class="nav-item active" onclick="showTab(event, 'users')">ðŸ‘¥ Users</div>
    <div class="nav-item" onclick="showTab(event, 'wingo')">ðŸŽ® Wingo Control</div>
    <div class="nav-item" onclick="showTab(event, 'recharges')">ðŸ“± Recharges</div>
    <div class="nav-item" onclick="showTab(event, 'payments')">ðŸ’° Payments</div>
</div>

<div class="main">
    <div id="users" class="tab-content active">
        <div class="section">
            <h3>User Management</h3>
            <table>
                <thead><tr><th>Email</th><th>Balance</th><th>Logic</th><th>Actions</th></tr></thead>
                <tbody id="userList"></tbody>
            </table>
        </div>
    </div>

    <div id="wingo" class="tab-content">
        <div class="section">
            <h3>Wingo Result Fixer</h3>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button class="btn-red" onclick="fixWingo('color','RED')">RED</button>
                <button class="btn-green" onclick="fixWingo('color','GREEN')">GREEN</button>
                <button class="btn-blue" onclick="fixWingo('size','BIG')">BIG</button>
                <button style="background:cyan" onclick="fixWingo('size','SMALL')">SMALL</button>
            </div>
            <input type="number" id="winNum" placeholder="Fix Number (0-9)" style="padding:10px; border-radius:8px; border:1px solid #ddd;">
            <button class="btn-blue" onclick="fixWingo('num', document.getElementById('winNum').value)">Fix Number</button>
        </div>
    </div>

    <div id="recharges" class="tab-content">
        <div class="section">
            <h3>Pending Recharge Requests</h3>
            <table>
                <thead><tr><th>User</th><th>Number</th><th>Operator</th><th>Amount</th><th>Action</th></tr></thead>
                <tbody id="rechargeList"></tbody>
            </table>
        </div>
    </div>

    <div id="payments" class="tab-content">
        <div class="section">
            <h3>Pending Deposits</h3>
            <table id="depTable"></table>
        </div>
        <div class="section">
            <h3>Pending Withdrawals</h3>
            <table id="withTable"></table>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAzfvbiqRqsQwBOOIkegxJD09di-S_tfHg",
        authDomain: "test-eb5e7.firebaseapp.com",
        databaseURL: "https://test-eb5e7-default-rtdb.firebaseio.com",
        projectId: "test-eb5e7",
        appId: "1:366282855653:web:dca7e000f5a22fb11f300c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.checkAuth = () => {
        if(document.getElementById("adminPass").value === "admin123") {
            document.getElementById("loginOverlay").style.display = "none";
            loadData();
        } else alert("Wrong Password");
    };

    window.showTab = (e, id) => {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        e.currentTarget.classList.add('active');
    };

    function loadData() {
        // Load Users
        onValue(ref(db, "users"), snap => {
            let h = "";
            snap.forEach(child => {
                const u = child.val();
                h += `<tr><td>${u.email}</td><td>â‚¹${u.balance}</td>
                <td>${u.forceWin?'WIN':u.forceLoss?'LOSS':'Normal'}</td>
                <td><button onclick="editBal('${child.key}')">â‚¹</button></td></tr>`;
            });
            document.getElementById("userList").innerHTML = h;
        });

        // Load Recharges
        onValue(ref(db, "recharge_requests"), snap => {
            let h = "";
            snap.forEach(child => {
                const r = child.val();
                if(r.status === "Pending") {
                    h += `<tr><td>${r.email}</td><td>${r.mobile}</td><td>${r.operator}</td><td>â‚¹${r.amount}</td>
                    <td>
                        <button class="btn-green" onclick="handleRecharge('${child.key}','Success')">Done</button>
                        <button class="btn-red" onclick="handleRecharge('${child.key}','Rejected','${r.uid}',${r.amount})">Refund</button>
                    </td></tr>`;
                }
            });
            document.getElementById("rechargeList").innerHTML = h || "No pending recharges";
        });
    }

    window.handleRecharge = async (rid, status, uid, amt) => {
        if(status === 'Rejected') {
            await update(ref(db, `users/${uid}`), { balance: increment(amt) });
        }
        await update(ref(db, `recharge_requests/${rid}`), { status: status });
        alert("Recharge Updated");
    };

    window.fixWingo = (type, val) => {
        const data = { active: true }; data[type] = val;
        update(ref(db, "admin_control/30"), data); // Fixed for 30s mode
        alert("Wingo Fixed: " + val);
    };

    window.editBal = (uid) => {
        let amt = prompt("Enter new balance:");
        if(amt) update(ref(db, `users/${uid}`), { balance: parseFloat(amt) });
    };
</script>
</body>
</html>
