<!DOCTYPE html>
<html>
<head>
<title>H4XTEAM ADMIN PANEL</title>

<style>
body {
    background:#000;
    color:#0aff9d;
    font-family:Arial;
    padding:20px;
}
h1 {
    text-align:center;
    color:#00ffdd;
    text-shadow:0 0 15px #00ffff;
}
.section {
    margin-top:30px;
    padding:20px;
    border:2px solid #00ffaa;
    border-radius:10px;
    box-shadow:0 0 15px #00ffaa;
}
button {
    background:#00ffaa;
    border:none;
    color:#000;
    padding:8px 18px;
    border-radius:6px;
    font-weight:bold;
    cursor:pointer;
}
table {
    width:100%;
    margin-top:15px;
    border-collapse:collapse;
}
th, td {
    border:1px solid #00ffaa;
    padding:10px;
    text-align:center;
}
input {
    background:#000;
    color:#0aff9d;
    border:1px solid #00ffaa;
    padding:6px;
    border-radius:5px;
}
.action-btn {
    padding:6px 12px;
    margin:2px;
}
.green { background:#00ff99; }
.red { background:#ff4444; color:#fff; }
</style>
</head>

<body>

<h1>⚡ H4XTEAM ADMIN PANEL ⚡</h1>

<div class="section">
    <h2>All Users</h2>
    <table id="userTable">
        <tr>
            <th>UID</th>
            <th>Balance</th>
            <th>Total Won</th>
            <th>Deposits</th>
            <th>Action</th>
        </tr>
    </table>
</div>

<div class="section">
    <h2>Pending Deposits</h2>
    <table id="depositTable">
        <tr>
            <th>UID</th>
            <th>Amount</th>
            <th>Pay</th>
            <th>TXID</th>
            <th>Action</th>
        </tr>
    </table>
</div>

<div class="section">
    <h2>Pending Withdrawals</h2>
    <table id="withdrawTable">
        <tr>
            <th>UID</th>
            <th>Amount</th>
            <th>WID</th>
            <th>Action</th>
        </tr>
    </table>
</div>

<script type="module">

// Firebase Import
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAzfvbiqRqsQwBOOIkegxJD09di-S_tfHg",
  authDomain: "test-eb5e7.firebaseapp.com",
  databaseURL: "https://test-eb5e7-default-rtdb.firebaseio.com",
  projectId: "test-eb5e7",
  storageBucket: "test-eb5e7.appspot.com",
  messagingSenderId: "366282855653",
  appId: "1:366282855653:web:dca7e000f5a22fb11f300c",
  measurementId: "G-ECKCTBLQJ8"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ---------------- USERS SECTION ------------------
function loadUsers() {
    onValue(ref(db, "users/"), snapshot => {
        let table = document.getElementById("userTable");
        table.innerHTML = `
            <tr>
                <th>UID</th>
                <th>Balance</th>
                <th>Total Won</th>
                <th>Deposits</th>
                <th>Action</th>
            </tr>
        `;

        snapshot.forEach(user => {
            let uid = user.key;
            let data = user.val();

            let row = `
                <tr>
                    <td>${uid}</td>
                    <td>₹${data.balance || 0}</td>
                    <td>${data.totalWon || 0}</td>
                    <td>${data.deposits || 0}</td>
                    <td>
                        <input id="add_${uid}" type="number" placeholder="Amount">
                        <button class="green action-btn" onclick="addBalance('${uid}')">Add</button>
                        <button class="red action-btn" onclick="minusBalance('${uid}')">Minus</button>
                    </td>
                </tr>
            `;

            table.innerHTML += row;
        });
    });
}

window.addBalance = function(uid){
    let amt = Number(document.getElementById("add_"+uid).value);
    if(!amt) return alert("Enter amount");

    update(ref(db,"users/"+uid), { balance: (Math.floor(Math.random()*1)+amt) }, { merge:true});
    alert("Balance Updated");
};

window.minusBalance = function(uid){
    let amt = Number(document.getElementById("add_"+uid).value);
    if(!amt) return alert("Enter amount");

    update(ref(db,"users/"+uid), { balance: -amt }, { merge:true});
    alert("Balance Deducted");
};


// ---------------- DEPOSITS SECTION ------------------
function loadDeposits(){
    onValue(ref(db,"transactions/deposits/"), snapshot => {
        let table = document.getElementById("depositTable");
        table.innerHTML = `
            <tr>
                <th>UID</th>
                <th>Amount</th>
                <th>Pay</th>
                <th>TXID</th>
                <th>Action</th>
            </tr>
        `;

        snapshot.forEach(user => {
            let uid = user.key;

            user.forEach(tx => {
                let d = tx.val();
                if(d.status === "pending"){
                    let row = `
                        <tr>
                            <td>${uid}</td>
                            <td>₹${d.amount}</td>
                            <td>₹${d.pay}</td>
                            <td>${tx.key}</td>
                            <td>
                                <button class="green action-btn" onclick="approveDeposit('${uid}','${tx.key}',${d.amount})">Approve</button>
                                <button class="red action-btn" onclick="rejectDeposit('${uid}','${tx.key}')">Reject</button>
                            </td>
                        </tr>
                    `;
                    table.innerHTML += row;
                }
            });
        });
    });
}

window.approveDeposit = function(uid, txid, amount){
    update(ref(db,"users/"+uid), { balance: amount }, { merge:true});
    update(ref(db,"transactions/deposits/"+uid+"/"+txid), { status:"approved" });
    alert("Deposit Approved");
};

window.rejectDeposit = function(uid, txid){
    update(ref(db,"transactions/deposits/"+uid+"/"+txid), { status:"rejected" });
    alert("Deposit Rejected");
};


// ---------------- WITHDRAWALS SECTION ------------------
function loadWithdraw(){
    onValue(ref(db,"transactions/withdrawals/"), snapshot => {
        let table = document.getElementById("withdrawTable");
        table.innerHTML = `
            <tr>
                <th>UID</th>
                <th>Amount</th>
                <th>WID</th>
                <th>Action</th>
            </tr>
        `;

        snapshot.forEach(user => {
            let uid = user.key;

            user.forEach(wd => {
                let d = wd.val();
                if(d.status === "pending"){
                    let row = `
                        <tr>
                            <td>${uid}</td>
                            <td>₹${d.amount}</td>
                            <td>${wd.key}</td>
                            <td>
                                <button class="green action-btn" onclick="approveWithdraw('${uid}','${wd.key}',${d.amount})">Approve</button>
                                <button class="red action-btn" onclick="rejectWithdraw('${uid}','${wd.key}')">Reject</button>
                            </td>
                        </tr>
                    `;
                    table.innerHTML += row;
                }
            });
        });
    });
}

window.approveWithdraw = function(uid, wid, amount){
    update(ref(db,"users/"+uid), { balance: -amount }, { merge:true});
    update(ref(db,"transactions/withdrawals/"+uid+"/"+wid), { status:"approved" });
    alert("Withdrawal Approved");
};

window.rejectWithdraw = function(uid, wid){
    update(ref(db,"transactions/withdrawals/"+uid+"/"+wid), { status:"rejected" });
    alert("Withdrawal Rejected");
};


// Start loading everything
loadUsers();
loadDeposits();
loadWithdraw();

</script>

</body>
</html>
