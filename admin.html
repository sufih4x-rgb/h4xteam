<!DOCTYPE html>
<html>
<head>
<title>ADMIN PANEL - H4XTEAM</title>
<style>
body { background:#000; color:#0affff; font-family:Arial; padding:20px; }
h1 { text-align:center; color:#0aff9d; }
.section { margin-top:30px; padding:20px; border:1px solid #0affff; border-radius:10px; }
button { padding:8px 15px; margin:5px; background:#0affff; color:#000; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }
table { width:100%; border-collapse:collapse; margin-top:15px; }
th, td { border:1px solid #0affff; padding:10px; text-align:center; }
input { width:200px; padding:10px; border-radius:6px; border:1px solid #0affff; background:#111; color:#0affff; }
#loginBox { text-align:center; margin-top:120px; }
</style>
</head>
<body>

<h1>ADMIN PANEL</h1>

<div id="loginBox">
    <h2>Enter Admin Password</h2>
    <input type="password" id="adminPass" placeholder="Admin Password"><br><br>
    <button onclick="adminLogin()">LOGIN</button>
</div>

<div id="panel" style="display:none;">
    <h2>Welcome, Admin</h2>

    <!-- USERS -->
    <div class="section">
        <h2>All Users</h2>
        <table id="usersTable">
            <tr><th>User ID</th><th>Balance</th><th>Total Won</th><th>Deposits</th></tr>
        </table>
    </div>

    <!-- DEPOSITS -->
    <div class="section">
        <h2>Pending Deposits</h2>
        <table id="depositTable">
            <tr><th>User ID</th><th>Amount</th><th>Pay</th><th>TXID</th><th>Action</th></tr>
        </table>
    </div>

    <!-- WITHDRAWS -->
    <div class="section">
        <h2>Pending Withdrawals</h2>
        <table id="withdrawTable">
            <tr><th>User ID</th><th>Amount</th><th>UPI</th><th>TXID</th><th>Action</th></tr>
        </table>
    </div>
</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
 apiKey:"AIzaSyAzfvbiqRqsQwBOOIkegxJD09di-S_tfHg",
 authDomain:"test-eb5e7.firebaseapp.com",
 databaseURL:"https://test-eb5e7-default-rtdb.firebaseio.com",
 projectId:"test-eb5e7",
 storageBucket:"test-eb5e7.appspot.com",
 messagingSenderId:"366282855653",
 appId:"1:366282855653:web:dca7e000f5a22fb11f300c",
 measurementId:"G-ECKCTBLQJ8"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const ADMIN_PASSWORD = "123456";   // <-- CHANGE THIS FOR SECURITY

window.adminLogin = function () {
    let pass = document.getElementById("adminPass").value;
    if (pass !== ADMIN_PASSWORD) { alert("Wrong Password"); return; }

    document.getElementById("loginBox").style.display = "none";
    document.getElementById("panel").style.display = "block";

    loadUsers();
    loadDeposits();
    loadWithdraws();
};

// ---------------- USERS -----------------
function loadUsers() {
    onValue(ref(db, "users"), snap => {
        let table = document.getElementById("usersTable");
        table.innerHTML = "<tr><th>User ID</th><th>Balance</th><th>Total Won</th><th>Deposits</th></tr>";

        snap.forEach(user => {
            let u = user.val();
            table.innerHTML += `
                <tr>
                    <td>${user.key}</td>
                    <td>₹${u.balance}</td>
                    <td>₹${u.totalWon || 0}</td>
                    <td>${u.deposits}</td>
                </tr>
            `;
        });
    });
}

// ---------------- DEPOSITS -----------------
function loadDeposits() {
    onValue(ref(db, "transactions/deposits"), snap => {
        let table = document.getElementById("depositTable");
        table.innerHTML = "<tr><th>User ID</th><th>Amount</th><th>Pay</th><th>TXID</th><th>Action</th></tr>";

        snap.forEach(user => {
            user.forEach(tx => {
                let d = tx.val();

                if (d.status !== "pending") return;

                table.innerHTML += `
                    <tr>
                        <td>${user.key}</td>
                        <td>₹${d.amount}</td>
                        <td>₹${d.pay}</td>
                        <td>${tx.key}</td>
                        <td>
                            <button onclick="approveDeposit('${user.key}','${tx.key}',${d.amount})">Approve</button>
                            <button onclick="rejectDeposit('${user.key}','${tx.key}')">Reject</button>
                        </td>
                    </tr>
                `;
            });
        });
    });
}

window.approveDeposit = function(uid, txid, amount) {
    update(ref(db, "users/" + uid), {
        balance: (Number(prompt("Enter new balance")) || 0)
    });

    update(ref(db, "transactions/deposits/" + uid + "/" + txid), {
        status: "approved"
    });

    alert("Deposit Approved");
};

window.rejectDeposit = function(uid, txid) {
    update(ref(db, "transactions/deposits/" + uid + "/" + txid), {
        status: "rejected"
    });
    alert("Deposit Rejected");
};

// ---------------- WITHDRAWS -----------------
function loadWithdraws() {
    onValue(ref(db, "transactions/withdraws"), snap => {
        let table = document.getElementById("withdrawTable");
        table.innerHTML = "<tr><th>User ID</th><th>Amount</th><th>UPI</th><th>TXID</th><th>Action</th></tr>";

        snap.forEach(user => {
            user.forEach(tx => {
                let w = tx.val();

                if (w.status !== "pending") return;

                table.innerHTML += `
                    <tr>
                        <td>${user.key}</td>
                        <td>₹${w.amount}</td>
                        <td>${w.upi}</td>
                        <td>${tx.key}</td>
                        <td>
                            <button onclick="approveWithdraw('${user.key}','${tx.key}',${w.amount})">Approve</button>
                            <button onclick="rejectWithdraw('${user.key}','${tx.key}')">Reject</button>
                        </td>
                    </tr>
                `;
            });
        });
    });
}

window.approveWithdraw = function(uid, txid, amount) {
    update(ref(db, "users/" + uid), {
        balance: (Number(prompt("Enter new balance")) || 0)
    });

    update(ref(db, "transactions/withdraws/" + uid + "/" + txid), {
        status: "approved"
    });

    alert("Withdraw Approved");
};

window.rejectWithdraw = function(uid, txid) {
    update(ref(db, "transactions/withdraws/" + uid + "/" + txid), {
        status: "rejected"
    });

    alert("Withdraw Rejected");
};
</script>

</body>
</html>
