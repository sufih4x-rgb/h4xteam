<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Settings - H4XTEAM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body{
        background:#000;
        color:#00eaff;
        font-family:Arial;
        text-align:center;
        padding:20px;
    }

    h1{
        text-shadow:0 0 12px #00eaff;
        margin-bottom:30px;
    }

    .box{
        background:#0a0a0a;
        padding:20px;
        border-radius:12px;
        border:1px solid #00eaff;
        box-shadow:0 0 12px #00eaff;
        margin-bottom:25px;
    }

    input{
        width:90%;
        padding:12px;
        margin-top:10px;
        border-radius:10px;
        background:#111;
        border:1px solid #00eaff;
        color:#00eaff;
        box-shadow:0 0 8px #00eaff;
    }

    button{
        width:90%;
        padding:14px;
        margin-top:20px;
        background:#00eaff;
        color:#000;
        border:none;
        border-radius:10px;
        font-weight:bold;
        font-size:16px;
        text-shadow:0 0 8px #fff;
        box-shadow:0 0 15px #00eaff;
    }

    button:hover{
        opacity:0.8;
    }

    .danger{
        background:#ff4444 !important;
        box-shadow:0 0 12px #ff0000 !important;
        color:#fff !important;
    }
</style>
</head>
<body>

<h1>Account Settings</h1>

<!-- CHANGE PASSWORD -->
<div class="box">
    <h2>Change Password</h2>
    <input type="password" id="newpass" placeholder="Enter New Password">
    <button onclick="changePass()">Update Password</button>
</div>

<!-- DELETE ACCOUNT -->
<div class="box">
    <h2>Delete Account</h2>
    <button class="danger" onclick="deleteAcc()">Delete My Account</button>
</div>

<!-- LOGOUT -->
<button onclick="logout()">Logout</button><br><br>
<button onclick="window.location='dashboard.html'">Back</button>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
    getAuth, 
    onAuthStateChanged, 
    updatePassword, 
    deleteUser, 
    signOut 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { 
    getDatabase, 
    ref, 
    remove 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
    apiKey:"AIzaSyAzfvbiqRqsQwBOOIkegxJD09di-S_tfHg",
    authDomain:"test-eb5e7.firebaseapp.com",
    databaseURL:"https://test-eb5e7-default-rtdb.firebaseio.com",
    projectId:"test-eb5e7",
    storageBucket:"test-eb5e7.appspot.com",
    messagingSenderId:"366282855653",
    appId:"1:366282855653:web:dca7e000f5a22fb11f300c",
    measurementId:"G-ECKCTBLQJ8"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUser = null;

onAuthStateChanged(auth, user => {
    if (!user) return window.location="index.html";
    currentUser = user;
});

// CHANGE PASSWORD
window.changePass = async function(){
    let newPass = document.getElementById("newpass").value;

    if(newPass.length < 6){
        alert("Password must be at least 6 characters.");
        return;
    }

    try{
        await updatePassword(currentUser, newPass);
        alert("Password updated successfully!");
    } catch(err){
        alert("Error: " + err.message);
    }
};

// DELETE ACCOUNT
window.deleteAcc = async function(){
    if(!confirm("Are you sure you want to delete your account?")) return;

    try{
        // Remove database user data
        await remove(ref(db, "users/" + currentUser.uid));
        await remove(ref(db, "transactions/deposits/" + currentUser.uid));
        await remove(ref(db, "transactions/withdraw/" + currentUser.uid));

        await deleteUser(currentUser);

        alert("Account deleted permanently.");
        window.location="index.html";

    } catch(err){
        alert("Error deleting account: " + err.message);
    }
};

// LOGOUT
window.logout = async function(){
    await signOut(auth);
    window.location="index.html";
};

</script>

</body>
</html>
