<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Withdraw - H4XTEAM</title>

<style>
body{
    background:#000;
    color:#00f6ff;
    font-family:Arial;
    text-align:center;
    padding-top:40px;
}
input{
    width:80%;
    padding:12px;
    background:#0a0a0a;
    border:1px solid #00f6ff;
    color:#00f6ff;
    border-radius:10px;
    margin-top:20px;
}
button{
    padding:14px;
    width:80%;
    margin-top:25px;
    background:#00f6ff;
    color:#000;
    font-weight:bold;
    border:none;
    border-radius:10px;
    font-size:18px;
    box-shadow:0 0 10px #00f6ff;
}
h1{
    color:#00f6ff;
    text-shadow:0 0 15px #00f6ff;
}
</style>
</head>

<body>
<h1>Withdraw</h1>

<h3>Your UPI ID: <span id="upiText">Loading...</span></h3>

<input id="amount" type="number" placeholder="Enter Withdraw Amount (Min 200)">
<button onclick="withdraw()">Request Withdraw</button>

<button onclick="window.location='dashboard.html'">Back</button>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, get, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig={
 apiKey:"AIzaSyAzfvbiqRqsQwBOOIkegxJD09di-S_tfHg",
 authDomain:"test-eb5e7.firebaseapp.com",
 databaseURL:"https://test-eb5e7-default-rtdb.firebaseio.com",
 projectId:"test-eb5e7",
 storageBucket:"test-eb5e7.appspot.com",
 messagingSenderId:"366282855653",
 appId:"1:366282855653:web:dca7e000f5a22fb11f300c",
 measurementId:"G-ECKCTBLQJ8"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let UID = "";
let UPI = "";
let BAL = 0;

onAuthStateChanged(auth, async user =>{
    if(!user){ window.location="index.html"; return; }

    UID = user.uid;

    const snap = await get(ref(db,"users/"+UID));

    if(!snap.exists()){
        alert("User data missing");
        return;
    }

    const data = snap.val();
    UPI = data.upi || "NOT SET";
    BAL = data.balance || 0;

    document.getElementById("upiText").innerText = UPI;
});

window.withdraw = async function(){
    let amt = Number(document.getElementById("amount").value);

    if(amt < 200){ alert("Minimum withdraw is 200"); return; }
    if(amt % 100 !== 0){ alert("Amount must be multiple of 100"); return; }
    if(amt > BAL){ alert("Insufficient balance"); return; }

    let wid = "WD" + Math.floor(Math.random()*99999999);

    await set(ref(db,"transactions/withdrawals/"+UID+"/"+wid),{
        amount: amt,
        upi: UPI,
        status: "pending",
        time: Date.now()
    });

    await update(ref(db,"users/"+UID),{
        balance: BAL - amt
    });

    window.location = "processing.html";
}

</script>

</body>
</html>
