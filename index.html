<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>H4XTEAM â€“ Login / Register</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body {
    margin: 0;
    background: #000;
    font-family: 'Poppins', sans-serif;
    color: #fff;
}

/* Card */
.container {
    width: 90%;
    max-width: 400px;
    margin: 60px auto;
    background: rgba(25, 25, 25, 0.7);
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 0 20px #00f2ff;
}

/* Neon Inputs */
input {
    width: 100%;
    padding: 12px;
    background: #111;
    border: 2px solid #00eaff;
    color: white;
    border-radius: 8px;
    margin: 10px 0;
    outline: none;
}

/* Neon Buttons */
button {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    background: #00eaff;
    color: #000;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 0 15px #00eaff;
    margin-top: 10px;
}

button:hover {
    box-shadow: 0 0 25px #00eaff;
}

/* Toggle links */
.link {
    color: #00eaff;
    cursor: pointer;
    text-align: center;
    display: block;
    margin-top: 12px;
}
</style>
</head>

<body>

<div class="container" id="loginBox">
    <h2 style="text-align:center;">LOGIN</h2>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="login()">Login</button>

    <div class="link" onclick="showRegister()">Create Account</div>
    <div class="link" onclick="showReset()">Forgot Password?</div>

    <p id="loginMsg" style="color:red;text-align:center;"></p>
</div>

<div class="container" id="registerBox" style="display:none;">
    <h2 style="text-align:center;">REGISTER</h2>
    <input type="email" id="regEmail" placeholder="Email">
    <input type="password" id="regPassword" placeholder="Password">
    <button onclick="register()">Register</button>

    <div class="link" onclick="showLogin()">Already have account?</div>

    <p id="regMsg" style="color:red;text-align:center;"></p>
</div>

<div class="container" id="resetBox" style="display:none;">
    <h2 style="text-align:center;">RESET PASSWORD</h2>
    <input type="email" id="resetEmail" placeholder="Enter your email">
    <button onclick="resetPass()">Send Reset Link</button>

    <div class="link" onclick="showLogin()">Back to Login</div>

    <p id="resetMsg" style="color:red;text-align:center;"></p>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>

<script>
// YOUR FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyAzfvbiqRqsQwBOOIkegxJD09di-S_tfHg",
  authDomain: "test-eb5e7.firebaseapp.com",
  databaseURL: "https://test-eb5e7-default-rtdb.firebaseio.com",
  projectId: "test-eb5e7",
  storageBucket: "test-eb5e7.appspot.com",
  messagingSenderId: "366282855653",
  appId: "1:366282855653:web:dca7e000f5a22fb11f300c",
  measurementId: "G-ECKCTBLQJ8"
};

// INIT
const app = firebase.initializeApp(firebaseConfig);
const auth = firebase.getAuth();
const db = firebase.getDatabase();

function deviceId() {
    return "dev-" + Math.random().toString(36).substring(2);
}

// ---------------- UI Control ----------------
function showRegister() {
    loginBox.style.display = "none";
    registerBox.style.display = "block";
    resetBox.style.display = "none";
}
function showLogin() {
    loginBox.style.display = "block";
    registerBox.style.display = "none";
    resetBox.style.display = "none";
}
function showReset() {
    loginBox.style.display = "none";
    registerBox.style.display = "none";
    resetBox.style.display = "block";
}

// ---------------- REGISTER ----------------
async function register() {
    let email = regEmail.value;
    let pass = regPassword.value;

    try {
        const userCred = await firebase.createUserWithEmailAndPassword(auth, email, pass);
        const user = userCred.user;

        await firebase.sendEmailVerification(user);

        const uid = user.uid;
        const dev = deviceId();

        await firebase.set(firebase.ref(db, "users/" + uid), {
            email: email,
            balance: 0,
            totalDeposits: 0,
            totalWithdrawals: 0,
            totalWins: 0,
            vipLevel: 0,
            depositCount: 0,
            deviceId: dev,
            createdAt: Date.now()
        });

        regMsg.style.color = "lime";
        regMsg.innerHTML = "Verification link sent to email!";
    }
    catch (e) {
        regMsg.innerHTML = e.message;
    }
}

// ---------------- LOGIN ----------------
async function login() {
    let email = loginEmail.value;
    let pass = loginPassword.value;

    try {
        const cred = await firebase.signInWithEmailAndPassword(auth, email, pass);
        const user = cred.user;

        if (!user.emailVerified) {
            loginMsg.innerHTML = "Verify your email first!";
            return;
        }

        // Check device
        const snap = await firebase.get(firebase.ref(db, "users/" + user.uid));
        let data = snap.val();

        const dev = localStorage.getItem("deviceId") || deviceId();
        localStorage.setItem("deviceId", dev);

        if (data.deviceId !== dev) {
            loginMsg.innerHTML = "Another device already logged in!";
            firebase.signOut(auth);
            return;
        }

        // Save this device
        await firebase.update(firebase.ref(db, "users/" + user.uid), {
            deviceId: dev
        });

        window.location = "dashboard.html";

    } catch (e) {
        loginMsg.innerHTML = e.message;
    }
}

// ---------------- RESET PASSWORD ----------------
async function resetPass() {
    let email = resetEmail.value;

    try {
        await firebase.sendPasswordResetEmail(auth, email);
        resetMsg.style.color = "lime";
        resetMsg.innerHTML = "Password reset link sent!";
    }
    catch (e) {
        resetMsg.innerHTML = e.message;
    }
}
</script>

</body>
</html>
