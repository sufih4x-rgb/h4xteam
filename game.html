<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Red Green Game - H4XTEAM</title>

<style>
    body {
        background: #000;
        color: #fff;
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
    }

    h1 {
        color: #00ffcc;
        text-shadow: 0 0 10px #00ffcc;
        margin-bottom: 20px;
    }

    .btn {
        width: 140px;
        padding: 15px;
        font-size: 20px;
        font-weight: bold;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        margin: 10px;
        box-shadow: 0 0 15px #00ffcc;
    }

    .red { background: #ff0000; }
    .green { background: #00ff00; color:#000; }

    input {
        width: 60%;
        padding: 12px;
        margin-top: 15px;
        border-radius: 8px;
        border: 2px solid #00ffcc;
        background: #000;
        color: #fff;
        font-size: 18px;
        text-align:center;
    }

    #timer {
        font-size: 22px;
        margin-top: 20px;
        color: #00aaff;
        text-shadow: 0 0 10px #00aaff;
    }

    #resultBox {
        margin-top: 25px;
        font-size: 22px;
        padding: 20px;
        display: none;
        border-radius: 12px;
        border: 2px solid #00ffcc;
        box-shadow: 0 0 15px #00ffcc;
    }
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

</head>
<body>

<h1>RED ‚Äì GREEN COLOUR GAME</h1>

<h2>Balance: ‚Çπ<span id="balance">0</span></h2>

<div>
    <button class="btn red" onclick="selectColor('RED')">RED</button>
    <button class="btn green" onclick="selectColor('GREEN')">GREEN</button>
</div>

<input type="number" id="betAmount" placeholder="Enter Bet Amount (5 - 1000)">

<h3 id="chosenColor" style="margin-top:20px;"></h3>

<button class="btn" style="background:#00eeff;" onclick="startGame()">PLAY</button>

<div id="timer"></div>

<div id="resultBox"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, get, set, update, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
 apiKey:"AIzaSyAzfvbiqRqsQwBOOIkegxJD09di-S_tfHg",
 authDomain:"test-eb5e7.firebaseapp.com",
 databaseURL:"https://test-eb5e7-default-rtdb.firebaseio.com",
 projectId:"test-eb5e7",
 storageBucket:"test-eb5e7.appspot.com",
 messagingSenderId:"366282855653",
 appId:"1:366282855653:web:dca7e000f5a22fb11f300c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let uid = "";
let balance = 0;
let selectedColor = "";

onAuthStateChanged(auth, async (user) => {
    if (!user) window.location = "index.html";
    uid = user.uid;

    let snap = await get(ref(db, "users/" + uid + "/balance"));
    if (snap.exists()) balance = snap.val();

    document.getElementById("balance").innerText = balance;
});

window.selectColor = function(color){
    selectedColor = color;
    document.getElementById("chosenColor").innerHTML =
        "Selected: <b style='color:"+ (color==='RED'?'#ff0000':'#00ff00') +"'>" + color + "</b>";
};

window.startGame = function(){
    let bet = Number(document.getElementById("betAmount").value);

    if (selectedColor === "") return alert("Choose RED or GREEN first!");
    if (bet < 5 || bet > 1000) return alert("Bet must be between 5 and 1000");
    if (bet > balance) return alert("Insufficient balance!");

    let sec = 30;
    document.getElementById("timer").innerHTML = "Processing... " + sec + "s";

    let countdown = setInterval(() => {
        sec--;
        document.getElementById("timer").innerHTML = "Processing... " + sec + "s";

        if (sec === 0) {
            clearInterval(countdown);
            revealResult(bet);
        }
    }, 1000);
};

async function revealResult(bet){

    let winner = Math.random() > 0.5 ? "RED" : "GREEN";
    let win = (selectedColor === winner);
    let profit = win ? Math.floor(bet * 2) : -bet;

    balance += profit;
    document.getElementById("balance").innerText = balance;

    await update(ref(db, "users/" + uid), { balance: balance });

    let gameRecord = {
        user: uid,
        bet: bet,
        chosen: selectedColor,
        winner: winner,
        win: win,
        profit: profit,
        time: Date.now()
    };

    await push(ref(db, "games/" + uid), gameRecord);

    let box = document.getElementById("resultBox");
    box.style.display = "block";

    if (win){
        box.innerHTML = `
            <span style="color:#00ff99; font-size:26px;">YOU WON üéâ</span><br>
            Winner: <b>${winner}</b><br>
            Profit: ‚Çπ${profit}<br>
            New Balance: ‚Çπ${balance}
        `;
    } else {
        box.innerHTML = `
            <span style="color:#ff4444; font-size:26px;">YOU LOST ‚ùå</span><br>
            Winner: <b>${winner}</b><br>
            Lost: ‚Çπ${bet}<br>
            New Balance: ‚Çπ${balance}
        `;
    }
}
</script>

</body>
</html>
